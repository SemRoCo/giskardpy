# We are running Ubuntu 20.04 for noetic
FROM osrf/ros:noetic-desktop-full

# Setup Timezone stuff
ENV TZ=Europe/Berlin
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# dont get warning from "danagerous usage of apt-key" only a problem when keys go outof date (they allways have to be fetch on demand)
ENV APT_KEY_DONT_WARN_ON_DANGEROUS_USAGE=TRUE

# Install build dependencies
RUN apt update && \
    apt install -y python-rosdep python-rosinstall python-rosinstall-generator python-wstool build-essential python-pip && \
    apt install -y python-catkin-tools

# Init rosdep
RUN rosdep fix-permissions && \
    rosdep init && \
    rosdep update
    

# Install giskards python dependencies
RUN pip install pybullet && \
    pip install scipy && \
    pip install casadi && \
    pip install sortedcontainers && \
    pip install hypothesis==4.34.0 && \
    pip install pandas==0.24.2 && \
    pip install numpy==1.16

# Install run dependencies for giskardpy and the pr2 simulator
RUN apt install -y ros-melodic-joint-state-publisher-gui

# Copies your code file from your action repository to the filesystem path `/` of the container
COPY build.sh /build.sh
COPY test.sh /test.sh

# Code file to execute when the docker container starts up (`entrypoint.sh`)
RUN /bin/bash -c "source build.sh && source test.sh"
