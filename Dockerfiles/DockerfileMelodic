# We are running Ubuntu 18.04 for melodic
FROM osrf/ros:melodic-desktop-full

# Setup Timezone stuff
ENV TZ=Europe/Berlin
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# dont get warning from "danagerous usage of apt-key" only a problem when keys go outof date (they allways have to be fetch on demand)
ENV APT_KEY_DONT_WARN_ON_DANGEROUS_USAGE=TRUE

RUN apt update
RUN apt install -y python-pip

# Install build dependencies (see https://github.com/ros-infrastructure/rosdep/issues/807 )
RUN apt install -y python-rospkg=1.3.0-100 python-rosdep=0.20.1-1 python-rosinstall python-rosinstall-generator python-wstool build-essential && \
    apt install -y python-catkin-tools

# Init rosdep
RUN rosdep init || rm /etc/ros/rosdep/sources.list.d/20-default.list && rosdep init 
RUN rosdep update && sudo rosdep fix-permissions
    

# Install giskards python dependencies
RUN apt install -y python-tk
RUN pip install pybullet==3.0.8 && \
    pip install scipy==1.2.2 && \
    pip install casadi && \
    pip install sortedcontainers && \
    pip install hypothesis==4.34.0 && \
    pip install pandas==0.24.2 && \
    pip install numpy==1.16

# Install run dependencies for giskardpy and the pr2 simulator
RUN apt install -y ros-melodic-joint-state-publisher-gui

# Copies your code file from your action repository to the filesystem path `/` of the container
COPY build.sh /build.sh
COPY test.sh /test.sh

# Code file to execute when the docker container starts up (`entrypoint.sh`)
RUN /bin/bash -c "source build.sh"
RUN chmod +x ./test.sh
ENTRYPOINT ["/test.sh"]
